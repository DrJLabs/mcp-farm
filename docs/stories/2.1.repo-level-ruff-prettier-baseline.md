# Story 2.1: Repo-Level Ruff & Prettier Baseline

Status: Done

## Story

**As a** developer responsible for maintaining MCP Farm,
**I want** consistent linting and formatting coverage across all Python and documentation assets,
**so that** code reviews stay focused on behavior and the tooling baseline prevents style regressions across the monorepo.

Dependencies: SEED-epic-2-testing-foundations.md (S1 seed); GitHub Issue #5.

## Acceptance Criteria

1. A root Ruff configuration (`pyproject.toml` or `.ruff.toml`) exists and scopes linting/formatting to `fastmcp/`, `tests/`, `sample-deep-research-mcp/`, and `scripts/` directories, including Python version targets.
2. Repo-level `.pre-commit-config.yaml` runs Ruff lint (`ruff check --fix`) and format (`ruff format`) plus Prettier on Markdown/JSON/YAML. Hook IDs align with recommended versions (Ruff ≥ 0.5, Prettier ≥ 3.3).
3. Running `uvx ruff check` and `uvx ruff format --check` at repo root passes without uncommitted changes once hooks are applied.
4. Running `npx prettier --check '**/*.{md,json,yaml,yml}'` reports zero changes after the hooks are installed.
5. README (or docs/testing.md) references the new commands so contributors know how to run them locally.

Evidence: attach command outputs in the PR description or linked issue comment.

## Tasks / Subtasks

- [x] Ruff configuration baseline
  - [x] Create/extend root `pyproject.toml`/`.ruff.toml` with rule set, include paths, and ignore list (if any).
  - [ ] Remove redundant Ruff configuration from `fastmcp/pyproject.toml` or update it to inherit the root config.
- [x] Pre-commit automation
  - [x] Add repo-level `.pre-commit-config.yaml` with Ruff lint/format hooks and Prettier (Markdown/JSON/YAML) hook.
  - [x] Document hook versions and installation command (`uvx pre-commit install`).
- [x] Command validation
  - [x] Run `uvx ruff check` and `uvx ruff format --check` to confirm clean results.
  - [x] Run `npx prettier --check` across docs to confirm no pending formatting.
- [x] Documentation
  - [x] Update README or create `docs/testing.md` with instructions for Ruff/Prettier usage.
  - [x] Link documentation update in issue #5 and reference in PR notes.

## Dev Notes

- Ruff best practices: https://docs.astral.sh/ruff/ suggests storing configuration in `pyproject.toml` and coupling lint+format commands.
- Prettier 3.3 release: https://prettier.io/blog/2025/03/18/3.3.0.html highlights expanded Markdown performance; prefer the latest hook revision.
- Use `uvx` to run Ruff without installing globally; ensure `.pre-commit-config.yaml` uses `repo: https://github.com/astral-sh/ruff-pre-commit` with `ruff-check` and `ruff-format`.
- If fastmcp package retains package-specific ignores, call them out in comments and sync with root config to avoid divergence.
- Prettier hook can reuse `types_or: ["markdown", "json", "yaml"]` or explicit file globs.

### References

- Story Seed: docs/stories/SEED-epic-2-testing-foundations.md#s1--repo-level-ruff--prettier-baseline
- Testing/tooling plan: docs/issues/testing-tooling-baseline.md (if relocated, update reference).
- GitHub Issue: https://github.com/DrJLabs/mcp-farm/issues/5

## Testing

- Commands executed locally: `uvx ruff check .`, `uvx ruff format --check .`, `npx prettier --check '**/*.{md,json,yaml,yml}'`.
- Optional: run `pre-commit run --all-files` to validate hooks end-to-end.

## QA Results

- Risk Assessment: docs/qa/assessments/2.1-risk-20250916.md (Quinn — 2025-09-16)
- Test Design: docs/qa/assessments/2.1-test-design-20250916.md (Quinn — 2025-09-16)
- PO Validation: docs/qa/assessments/2.1-po-validation-20250916.md (Sarah — 2025-09-16)

## Change Log

| Date       | Version | Description                 | Author |
| ---------- | ------- | --------------------------- | ------ |
| 2025-09-16 | 0.1     | Initial story draft created | SM     |

## Dev Agent Record
### Agent Model Used
Codex CLI — dev agent

### Debug Log References
- `uvx ruff check .`
- `uvx ruff format --check .`
- `npx prettier --check '**/*.{md,mdx,json,yaml,yml}'`

### Completion Notes List
- Created root `pyproject.toml` with Ruff config targeting `fastmcp/src`, `tests`, `sample-deep-research-mcp`, and `scripts`.
- Added repo-level `.pre-commit-config.yaml` wiring Ruff lint/format hooks and Prettier 3.3.2.
- Introduced `docs/testing.md` quickstart documenting lint/format/test commands.
- Ran Ruff + Prettier across the repo to establish a clean baseline and confirmed checks succeed.
- Logged progress in GitHub Issue #5 for cross-team visibility.

### File List
pyproject.toml
.pre-commit-config.yaml
.prettierignore
docs/testing.md
docs/qa/gates/1.2-traefik-routing-and-tls-labels.yml
docs/brownfield-architecture.md
docs/onboarding-chatgpt.md
docs/prd.md
docs/validation.md
docs/stories/1.1.bootstrap-env-and-healthcheck.md
docs/stories/1.2.traefik-routing-and-tls-labels.md
docs/stories/1.3.prm-and-401-hint.md
docs/stories/2.1.repo-level-ruff-prettier-baseline.md
docs/stories/2.2.harmonize-config-and-type-checks.md
docs/stories/2.3.expand-unit-and-integration-coverage.md
docs/stories/2.4.ci-workflow-enforcement.md
docs/stories/2.5.developer-experience-documentation.md
docs/stories/README.md
docs/stories/SEED-epic-1-auth-streaming.md
docs/stories/SEED-epic-2-testing-foundations.md
sample-deep-research-mcp/README.md
sample-deep-research-mcp/records.json
