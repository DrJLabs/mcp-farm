# Story 2.2: Harmonize Package Configs & Type Checks

Status: Draft

## Story

**As a** maintainer of the MCP Farm mono-repo,
**I want** a single source of truth for Ruff and type-check settings,
**so that** package-level configuration stays aligned with the repo-wide tooling baseline and static analysis covers shared code.

Dependencies: Story 2.1 (repo-level Ruff/Prettier baseline) must be complete.

## Acceptance Criteria

1. `fastmcp/pyproject.toml` references the root Ruff configuration (no duplicate rule definitions); any residual per-package ignores are documented inline with rationale.
2. `tool.ty.src.include` (or equivalent config) covers `sample-deep-research-mcp/` and `tests/`; `tool.ty.rules` ignores are reviewed, with remaining suppressions documented in issue #5.
3. `uv run ty check` passes using the updated configuration.
4. `uvx ruff settings --config pyproject.toml` (or `ruff settings`) shows the same include/exclude paths when executed from repo root and `fastmcp/` subdirectory.
5. A summary comment is posted in GitHub issue #5 listing any lingering type-check ignore codes and planned follow-up tickets (if needed).

Evidence: attach `uv run ty check` output and `ruff settings` diff in PR description or link to issue comment.

## Tasks / Subtasks

- [ ] Consolidate Ruff configuration
  - [ ] Remove or simplify `tool.ruff` blocks inside `fastmcp/pyproject.toml` to inherit root settings.
  - [ ] Add inline comments for any per-module ignore overrides that must remain.
- [ ] Expand type-check coverage
  - [ ] Update `tool.ty.src.include`/`exclude` to cover shared modules and tests.
  - [ ] Review `tool.ty.rules` ignores; document rationale in Issue #5 and create follow-up tasks for high-count suppressions.
- [ ] Validation commands
  - [ ] Run `uv run ty check` at repo root; capture output.
  - [ ] Run `uvx ruff settings` from repo root and `fastmcp/` to confirm identical scope.
- [ ] Communication
  - [ ] Post summary comment in Issue #5 with results and remaining action items.

## Dev Notes

- `ty` supports configuration in `pyproject.toml`; ensure includes use forward slashes and relative paths.
- Consider adding a helper script (e.g., `scripts/typecheck.sh`) to standardize command for CI story.
- If ty cannot cover non-package directories, use stub modules or adjust `src` mapping accordingly.

### References

- Story Seed S2: docs/stories/SEED-epic-2-testing-foundations.md#s2--harmonize-package-configs--type-checks
- Testing/tooling plan: docs/issues/testing-tooling-baseline.md (Plan §2 section)
- GitHub Issue #5: https://github.com/DrJLabs/mcp-farm/issues/5

## Testing

- Commands: `uv run ty check`, `uvx ruff settings` (root + subdirectory).
- Optional: create pytest-based smoke that loads ty config using `tomllib` and asserts include paths.

## QA Results

- Risk Assessment: docs/qa/assessments/2.2-risk-20250916.md (Quinn — 2025-09-16)
- Test Design: docs/qa/assessments/2.2-test-design-20250916.md (Quinn — 2025-09-16)
- PO Validation: Pending — to be added once story is ready for PO review.

## Change Log

| Date       | Version | Description                | Author |
| ---------- | ------- | -------------------------- | ------ |
| 2025-09-16 | 0.1     | Initial draft of Story 2.2 | SM     |
