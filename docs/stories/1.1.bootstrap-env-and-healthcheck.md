# Story 1.1: Bootstrap Env and Healthcheck

Status: Ready for Review

## Story
**As a** developer/operator,
**I want** a basic environment file and a health endpoint,
**so that** the MCP server can start reliably and expose a simple readiness check before adding auth, routing, and streaming.

Dependencies: None (first story of Epic 1)

## Acceptance Criteria
1. `.env.example` exists and documents the baseline variables for local dev:
   - `BIND_HOST` and `BIND_PORT` with sensible defaults (see references).
   - Placeholders for hostnames used later (e.g., `MCP_HOST`, `AUTH_HOST`) may be included but are not required to pass this story.
2. `GET /healthz` returns JSON `{ "ok": true }` with HTTP 200 and `Content-Type: application/json` when the server is running locally.
3. Health endpoint works without Traefik (direct bind) in dev: `curl -sS http://127.0.0.1:8000/healthz | jq` shows `{ "ok": true }`.
4. Evidence added in the PR/commit message with the `curl` output for the health endpoint.

Note: Traefik HTTPS routing for health is verified in S2; this story focuses on server-side endpoint and env bootstrapping.

## Tasks / Subtasks
- [x] Env template
  - [x] Add or update `.env.example` with `BIND_HOST` (default `0.0.0.0`) and `BIND_PORT` (default `8000`).
  - [x] Add brief comments describing local vs container binds.
- [x] Health endpoint
  - [x] Ensure the sample server exposes `GET /healthz` that returns `{ "ok": true }`.
  - [x] Run the server locally and validate: `curl -sS http://127.0.0.1:8000/healthz | jq`.
- [x] Documentation and evidence
  - [x] Link to Validation Guide section for health.
  - [x] Paste the `curl` output into the PR/commit for traceability.

## Dev Notes
- Server framework
  - The sample server uses FastMCP with Starlette routes. A health route can be added via `@mcp.custom_route("/healthz", methods=["GET"])` and respond with `{"ok": true}`.
  - Source example: `sample-deep-research-mcp/sample_mcp.py` contains a `/healthz` route already; verify its response shape.
- Environment variables
  - Defaults for local dev: `BIND_HOST=0.0.0.0`, `BIND_PORT=8000`. In dev, you may test on `127.0.0.1:8000` before introducing Traefik.
  - Reference: docs/architecture/configuration-environment-variables.md.
  - Caution: Binding to `0.0.0.0` exposes on all interfaces; prefer `127.0.0.1` on shared networks or ensure a firewall.
- Validation
  - Health check: see docs/validation.md#4-health-check.
  - S2 will cover Traefik/TLS routing of health (HTTPS via `mcp.localhost`).
- File paths and quick starts
  - Sample server entry: `sample-deep-research-mcp/sample_mcp.py`.
  - Compose and Traefik labels are handled in S2; for S1 a direct run (uvicorn/fastapi via FastMCP) is acceptable.

### References (exact shards)
- PRD — Epic 1 Stories (Sequential): docs/prd.md#L141-L156
- Architecture — Next actions for Epic 1 (S1 focus): docs/architecture/next-actions-for-epic-1.md#L3-L4
- Architecture — Configuration — Environment Variables: docs/architecture/configuration-environment-variables.md#configuration-—-environment-variables
- Architecture — Observability & Health: docs/architecture/observability-health.md#observability--health
- Validation — Health Check: docs/validation.md#4-health-check

## Testing
- Approach: smoke test via `curl` against the running server; optional unit test asserting JSON body for `/healthz`.
- Scenarios
  - Health returns `{ "ok": true }` with HTTP 200.
- Response `Content-Type` is `application/json` and stable across restarts.

## QA Results
- Requirements Trace: docs/qa/assessments/1.1-trace-20250915.md
- NFR Assessment: docs/qa/assessments/1.1-nfr-20250915.md
- PO Validation: docs/qa/assessments/1.1-po-validation-20250915.md
- QA Gate: PASS — docs/qa/gates/1.1-bootstrap-env-and-healthcheck.yml (2025-09-15)

## Change Log

| Date       | Version | Description                      | Author |
| ---------- | ------- | -------------------------------- | ------ |
| 2025-09-15 | 0.1     | Initial draft of Story 1.1       | SM     |


## Dev Agent Record
### Agent Model Used
Codex CLI — dev agent

### Debug Log References
Server run evidence captured locally during validation:
- `.venv` created for isolated run; key deps installed: starlette, uvicorn, pydantic, pydantic-settings, rich, httpx, Authlib; local `fastmcp` installed in editable mode.
- Start: `PYTHONPATH=fastmcp/src BIND_HOST=127.0.0.1 BIND_PORT=8000 TRANSPORT=http python sample-deep-research-mcp/sample_mcp.py`
- Logs: `/tmp/mcp_server.log` (local machine)

### Completion Notes List
- Added defaults in `.env.example` with `BIND_HOST=0.0.0.0`, `BIND_PORT=8000` and clarified local vs container binds.
- Verified `GET /healthz` returns `{ "ok": true }` with `Content-Type: application/json` and HTTP 200.
- Linked Validation Guide section for health.
- Evidence of `curl` included in commit message for traceability.

### File List
.env.example
docs/stories/1.1.bootstrap-env-and-healthcheck.md
