# Test Design: Story 2.2 â€” Harmonize Package Configs & Type Checks

Date: 2025-09-16
Designer: Quinn (Test Architect)

## Test Strategy Overview
- Total test scenarios: 7
- Unit tests: 2 (29%)
- Integration tests: 5 (71%)
- E2E tests: 0
- Priority distribution: P0: 4, P1: 2, P2: 1

Focus areas: configuration integrity and type-check execution. Lightweight unit tests validate configuration parsing; integration tests ensure commands succeed across directories.

## Test Scenarios by Acceptance Criteria

### AC1: Package inherits root Ruff config

| ID           | Level | Priority | Test                                                                     | Justification |
|--------------|-------|----------|---------------------------------------------------------------------------|---------------|
| 2.2-UNIT-001 | Unit  | P0       | Load `pyproject.toml` and assert `tool.ruff` keys absent or delegated     | Prevent duplicate config |
| 2.2-INT-001  | Int   | P0       | `uvx ruff settings --config pyproject.toml` from repo root equals output from `fastmcp/` | Validates inheritance |

### AC2: Type checker includes shared modules/tests

| ID           | Level | Priority | Test                                                                     | Justification |
|--------------|-------|----------|---------------------------------------------------------------------------|---------------|
| 2.2-UNIT-002 | Unit  | P0       | Parse `tool.ty.src.include` list ensuring required paths present          | Guard against omissions |
| 2.2-INT-002  | Int   | P0       | `uv run ty check` at repo root returns exit code 0                        | Core functionality |

### AC3: Document ignores in Issue #5

| ID           | Level | Priority | Test                                                                     | Justification |
|--------------|-------|----------|---------------------------------------------------------------------------|---------------|
| 2.2-INT-003  | Int   | P1       | script or manual check confirming Issue #5 comment includes ignore summary | Traceability |

### AC4: Consistent Ruff scopes

| ID           | Level | Priority | Test                                                                     | Justification |
|--------------|-------|----------|---------------------------------------------------------------------------|---------------|
| 2.2-INT-004  | Int   | P1       | `uvx ruff check sample-deep-research-mcp` executes without errors         | Smoke per-directory |

### Additional Safeguards

| ID           | Level | Priority | Test                                                                     | Justification |
|--------------|-------|----------|---------------------------------------------------------------------------|---------------|
| 2.2-INT-005  | Int   | P2       | Measure `uv run ty check` runtime and record (<5 min)                     | Monitor perf risk |

## Risk Coverage
- OPS-221/OPS-222 mitigated via P0 tests.
- OPS-223/OPS-225 addressed via documentation and Issue #5 check.

## Recommended Execution Order
1. Run unit config audits (2.2-UNIT-001, 2.2-UNIT-002).
2. Execute P0 integration commands (2.2-INT-001, 2.2-INT-002).
3. Perform Issue #5 confirmation (2.2-INT-003) and per-directory smoke (2.2-INT-004).
4. Capture runtime metric (2.2-INT-005) for trend analysis.

## Notes for Implementers
- Unit tests can leverage Python `tomllib` to parse config into dicts.
- Consider adding automation script to compare `ruff settings` outputs as part of CI.
- Issue comment template should list ignore codes and counts for transparency.

## Gate Block (for future gate file)
```yaml
test_design:
  scenarios_total: 7
  by_level:
    unit: 2
    integration: 5
    e2e: 0
  by_priority:
    p0: 4
    p1: 2
    p2: 1
  coverage_gaps: []
```

## Story Hook
Test design matrix: docs/qa/assessments/2.2-test-design-20250916.md
