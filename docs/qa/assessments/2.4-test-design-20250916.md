# Test Design: Story 2.4 â€” CI Workflow Enforcement

Date: 2025-09-16
Designer: Quinn (Test Architect)

## Test Strategy Overview
- Total test scenarios: 8
- Unit tests: 0
- Integration tests: 8 (100%)
- Priority distribution: P0: 5, P1: 2, P2: 1

Testing relies on GitHub Actions runs; validation is evidence-driven through workflow logs and artifacts.

## Test Scenarios by Acceptance Criteria

### AC1/AC2: Workflow steps execute

| ID           | Level | Priority | Test                                                                 | Justification |
|--------------|-------|----------|---------------------------------------------------------------------|---------------|
| 2.4-INT-001  | Int   | P0       | Trigger workflow on branch; verify logs show Ruff lint, Ruff format check, Ty check, pytest steps | Ensures completeness |
| 2.4-INT-002  | Int   | P0       | Inspect `uv sync` step to confirm dependency install succeeded      | Baseline for later steps |

### AC3: Cache configuration

| ID           | Level | Priority | Test                                                                 | Justification |
|--------------|-------|----------|---------------------------------------------------------------------|---------------|
| 2.4-INT-003  | Int   | P1       | First run: cache miss logged; second run: cache hit recorded        | Validates caching |

### AC4: Coverage artifacts uploaded

| ID           | Level | Priority | Test                                                                 | Justification |
|--------------|-------|----------|---------------------------------------------------------------------|---------------|
| 2.4-INT-004  | Int   | P0       | Verify `coverage.xml` and HTML archive present in workflow artifacts | Evidence |

### AC5: Failure demonstration

| ID           | Level | Priority | Test                                                                 | Justification |
|--------------|-------|----------|---------------------------------------------------------------------|---------------|
| 2.4-INT-005  | Int   | P0       | Introduce lint violation; confirm workflow fails at Ruff step; collect run URL | Proves enforcement |

### Additional Safeguards

| ID           | Level | Priority | Test                                                                 | Justification |
|--------------|-------|----------|---------------------------------------------------------------------|---------------|
| 2.4-INT-006  | Int   | P1       | Ensure workflow triggers for both `push` to main and PR events via test runs | Trigger coverage |
| 2.4-INT-007  | Int   | P2       | Record total runtime; compare against 10-minute budget              | Monitor performance |
| 2.4-INT-008  | Int   | P0       | Confirm failure run includes link/comment in Issue #5 or PR thread  | Traceability |

## Risk Coverage
- OPS-401 addressed via P0 step verification.
- OPS-402 covered via cache hit/miss validation.
- BUS-401 satisfied through failure demo documentation.

## Recommended Execution Order
1. Initial workflow run (2.4-INT-001..004).
2. Second run to confirm caching (2.4-INT-003).
3. Failure demo run (2.4-INT-005) and record link (2.4-INT-008).
4. Trigger event checks (2.4-INT-006) and runtime measurement (2.4-INT-007).

## Notes for Implementers
- Use temporary branch (e.g., `ci-test`) for verifying triggers.
- Consider using GitHub CLI (`gh run view`) to capture artifact list programmatically.
- Document commands for re-running workflow in README or Issue #5 comment.

## Gate Block
```yaml
test_design:
  scenarios_total: 8
  by_level:
    unit: 0
    integration: 8
    e2e: 0
  by_priority:
    p0: 5
    p1: 2
    p2: 1
  coverage_gaps: []
```

## Story Hook
Test design matrix: docs/qa/assessments/2.4-test-design-20250916.md
