# QA Risk Profile — Story 1.2: Traefik Routing + TLS Labels

Date: 2025-09-15
Story: docs/stories/1.2.traefik-routing-and-tls-labels.md
Scope: Add Traefik proxy; route MCP over HTTPS using labels only.

## Summary
Overall Risk: Medium (Operational)
Primary Modes: Misrouting, TLS/ACME issues, health exposure/regressions.

## Top Risks (Probability × Impact)

1) TLS issuance fails (ACME/resolver misconfig)
- Prob: Medium | Impact: High
- Signals: Traefik logs show ACME errors; HTTPS returns 404/495; curl fails handshake.
- Mitigations: Use reference ACME config; for localhost, accept self‑signed or use mkcert; verify `entrypoints` and certresolver names. Reference: docs/architecture/reference-deployment-docker-traefik-proposed.md

2) Router rule mismatch → health not reachable over HTTPS
- Prob: Medium | Impact: Medium
- Signals: `https://mcp.localhost/healthz` 404/404 with Traefik default; router not attached to `websecure`.
- Mitigations: Ensure `traefik.http.routers.mcp.rule=Host(\`mcp.localhost\`)` and `entrypoints=websecure` with `tls=true`; LB port set to 8000.

3) Container bind mismatch (app not on 0.0.0.0:8000)
- Prob: Low–Med | Impact: High
- Signals: Router up but backend 502/504; Traefik service unhealthy.
- Mitigations: Set `BIND_HOST=0.0.0.0`, `BIND_PORT=8000`; confirm service expose/ports. Reference: docs/architecture/configuration-environment-variables.md

4) Hostname resolution gaps
- Prob: Medium | Impact: Medium
- Signals: curl to `mcp.localhost` resolves to internet or wrong IP.
- Mitigations: Add `/etc/hosts` entries for local testing or real DNS in non‑local; document prereqs in Validation Guide.

5) Traefik version/label drift
- Prob: Low | Impact: Medium
- Signals: Labels accepted but no routing; deprecation warnings.
- Mitigations: Match reference to installed Traefik version; prefer v3 label forms from the reference doc.

6) Security hygiene: accidental static config or token logging
- Prob: Low | Impact: High
- Signals: Static file mounts; Authorization headers in app/proxy logs.
- Mitigations: Keep routing label‑only; redact tokens; follow NFR logging guidance.

## Controls & Checks
- Configuration control: Compose kept minimal; labels applied only to MCP; no static files.
- Health exposure: Only `/healthz` unauth; PRM/401 auth paths deferred to S3+.
- Evidence: Capture `curl -sS https://mcp.localhost/healthz | jq` in PR; attach Traefik route list if needed.

## Residual Risk
- Acceptable for MVP given scope and mitigations; revisit after S4/S5 as TLS and streaming may interact with proxy timeouts.

