# QA Requirements Trace — Story 1.2: Traefik Routing + TLS Labels

Date: 2025-09-15
Story: docs/stories/1.2.traefik-routing-and-tls-labels.md

## Scope
Route MCP via Traefik using labels; HTTPS health reachable; no static Traefik config.

## Source Requirements
- PRD FR5: Traefik TLS + label-driven routing (docs/prd/requirements.md)
- PRD Ingress guidance (docs/prd/ingress-routing-traefik.md)
- Epic 1 S2 description (docs/prd/epic-list.md)

## Acceptance Criteria → Tests (Given–When–Then)

AC1 — Traefik service with web/websecure + ACME; health reachable via Traefik
- Given compose defines a `traefik` service with Docker provider and entrypoints `web` and `websecure`
- And the MCP service is attached with labels and exposes port 8000
- When the stack is started with `docker compose up -d`
- Then `curl -sS -k https://mcp.localhost/healthz | jq` returns `{ "ok": true }` and HTTP 200

AC2 — TLS enabled on router; HTTPS succeeds
- Given the router `mcp` has `entrypoints=websecure` and `tls=true` (certresolver configured)
- When an HTTPS request is issued to `mcp.localhost`
- Then the response is served over TLS (for local, self‑signed accepted with `-k`)

AC3 — Label‑only routing (no static files)
- Given the compose file
- When inspecting the Traefik container mounts and configuration
- Then no static routing files are mounted; only ACME storage and Docker provider are used

AC4 — App bind compatible (0.0.0.0:8000)
- Given the MCP app binds `0.0.0.0:8000` in container
- When Traefik forwards to service `mcp` on port 8000
- Then backend checks from the Traefik network to `http://mcp:8000/healthz` succeed

AC5 — Evidence captured per Validation Guide
- Given the Validation Guide commands
- When executing the health curl via Traefik
- Then the output is persisted in the PR/commit as evidence

## Coverage Map
- FR5 → AC1, AC2, AC3, AC4, AC5
- NFR5 (label‑only routing) → AC3
- NFR1 (Docker) → AC1 preconditions
- NFR4 (no secrets/log redaction) → Verified by manual review; not directly exercised in S2 tests

## Gaps / Notes
- Runtime evidence pending (compose up + curl). Until attached, gate remains CONCERNS.
