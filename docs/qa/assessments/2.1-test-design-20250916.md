# Test Design: Story 2.1 â€” Repo-Level Ruff & Prettier Baseline

Date: 2025-09-16
Designer: Quinn (Test Architect)

## Test Strategy Overview
- Total test scenarios: 8
- Unit tests: 1 (12%)
- Integration tests: 6 (75%)
- E2E tests: 1 (13%)
- Priority distribution: P0: 4, P1: 3, P2: 1

Rationale: This story is tooling-heavy. Tests focus on command execution, configuration integrity, and documentation updates. Integration-level validation (running lint/format commands) provides highest assurance.

## Test Scenarios by Acceptance Criteria

### AC1: Root Ruff configuration scopes directories

| ID           | Level       | Priority | Test                                                                 | Justification |
| ------------ | ----------- | -------- | -------------------------------------------------------------------- | ------------- |
| 2.1-UNIT-001 | Unit        | P0       | Parse root Ruff config and assert `src`/`extend` includes required dirs | Prevent missing coverage |
| 2.1-INT-001  | Integration | P0       | `uvx ruff check --select I --force-exclude` against repo root exits 0 | Ensures config applied |

### AC2: Repo-level pre-commit runs Ruff lint/format and Prettier

| ID           | Level       | Priority | Test                                                                 | Justification |
| ------------ | ----------- | -------- | -------------------------------------------------------------------- | ------------- |
| 2.1-INT-002  | Integration | P0       | `pre-commit run --all-files ruff-check` exits 0 and makes no changes | Validates lint hook |
| 2.1-INT-003  | Integration | P0       | `pre-commit run --all-files ruff-format` exits 0 (no pending fixes)   | Validates format hook |
| 2.1-INT-004  | Integration | P1       | `pre-commit run --all-files prettier` exits 0 and touches expected file types | Covers Prettier scope |

### AC3: Ruff commands pass cleanly

| ID           | Level       | Priority | Test                                                                 | Justification |
| ------------ | ----------- | -------- | -------------------------------------------------------------------- | ------------- |
| 2.1-INT-005  | Integration | P0       | `uvx ruff check .` on clean tree returns 0                          | Confirms lint clean |
| 2.1-INT-006  | Integration | P1       | `uvx ruff format --check .` returns 0                               | Confirms format clean |

### AC4: Prettier check passes

| ID           | Level       | Priority | Test                                                                 | Justification |
| ------------ | ----------- | -------- | -------------------------------------------------------------------- | ------------- |
| 2.1-INT-007  | Integration | P0       | `npx prettier --check '**/*.{md,mdx,json,yaml,yml}'` exits 0         | Validates doc formatting |

### AC5: Documentation updated

| ID           | Level       | Priority | Test                                                                 | Justification |
| ------------ | ----------- | -------- | -------------------------------------------------------------------- | ------------- |
| 2.1-E2E-001  | E2E         | P2       | Reviewer confirms README/docs/testing includes Ruff/Prettier commands | Human verification |

## Risk Coverage
- Mitigates OPS-201, OPS-202 via P0 command runs.
- Addresses OPS-204 through unit parse test.
- BUS-201 satisfied by documentation validation scenario.

## Recommended Execution Order
1. P0 unit config audit (2.1-UNIT-001).
2. P0 integration commands (2.1-INT-001, 2.1-INT-002, 2.1-INT-003, 2.1-INT-005, 2.1-INT-007).
3. P1 integration (2.1-INT-004, 2.1-INT-006).
4. P2 documentation review (2.1-E2E-001).

## Notes for Implementers
- Unit config test can load TOML using Python `tomllib` and assert presence of directories in `tool.ruff.lint.extend` or `tool.ruff` field.
- Consider adding `uvx ruff settings` command in CI to print effective config; compare expected directories.
- Prettier commands should leverage the repo `.prettierrc` if introduced; ensure Node version compatibility (>=18).
- Document fallback instructions for developers without global `npx` by pointing to `corepack enable` or `pnpm` alternative.

## Gate Block (for future gate file)
```yaml
test_design:
  scenarios_total: 8
  by_level:
    unit: 1
    integration: 6
    e2e: 1
  by_priority:
    p0: 4
    p1: 3
    p2: 1
  coverage_gaps:
    - Need follow-up ticket for performance benchmarking of lint stage if repo grows >5k files.
```

## Story Hook
Test design matrix: docs/qa/assessments/2.1-test-design-20250916.md
