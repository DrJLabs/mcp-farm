# Risk Profile: Story 2.1 â€” Repo-Level Ruff & Prettier Baseline

Date: 2025-09-16
Reviewer: Quinn (Test Architect)

## Executive Summary
- Total Risks Identified: 7
- Critical Risks: 0
- High Risks: 2
- Risk Score: 82/100 (calculated)

Primary exposure is automation drift: without a unified configuration, linting and formatting regressions cascade into downstream stories and CI work. Operational risk also exists if pre-commit hooks block contributors or slow CI due to misconfiguration. Security and performance impacts are low, but developer productivity and tooling alignment are central.

## Risk Distribution
- Security: 0
- Performance: 1 (0 critical)
- Data: 0
- Business: 1 (0 critical)
- Operational: 5 (2 high)

## Detailed Risk Register

### OPS-201: Ruff configuration misses directories
- Probability: High (3)
- Impact: High (3)
- Score: 9 (High)
- Description: Root config neglects `sample-deep-research-mcp/` or `scripts/`, leaving unformatted code.
- Mitigation: Explicit `src`/`extend` list; add regression tests that run Ruff over entire repo; document include paths.
- Testing Focus: Execute Ruff commands in CI covering repo root; add unit tests for config inference if feasible.

### OPS-202: Prettier hook under-scopes docs
- Probability: Medium (2)
- Impact: High (3)
- Score: 6 (High)
- Description: Hook globs exclude `.mdx` or nested docs, causing inconsistent doc diffs.
- Mitigation: Use Prettier `types_or` or explicit glob; run `prettier --list-different"**/*.{md,mdx,json,yaml,yml}"` in CI.
- Testing Focus: Command validation scenario ensures no pending changes after running Prettier.

### OPS-203: Contributors blocked by aggressive autofix
- Probability: Medium (2)
- Impact: Medium (2)
- Score: 4 (Medium)
- Description: `--fix` hooks rewrite imports unexpectedly or conflict with local editors.
- Mitigation: Document workflow; provide `ruff check --exit-non-zero-on-fix` in CI but allow local opt-out via documentation.
- Testing Focus: Smoke test pre-commit run on clean repo to ensure no infinite loops.

### OPS-204: Duplicate Ruff configs drift
- Probability: High (3)
- Impact: Medium (2)
- Score: 6 (Medium)
- Description: fastmcp package retains separate settings causing conflicting ignores.
- Mitigation: Consolidate configuration; add unit tests that parse config to ensure single source of truth.
- Testing Focus: Validate `ruff settings` output once to confirm only root config is active.

### PERF-201: CI duration spike from full-repo lint
- Probability: Medium (2)
- Impact: Medium (2)
- Score: 4 (Medium)
- Description: Lint/format on large tree may exceed CI budget.
- Mitigation: Use caching (`uv` cache, Prettier `cache: true`), parallelize where possible.
- Testing Focus: Track CI runtime; set alert if lint stage >3 minutes.

### BUS-201: Documentation not updated, onboarding confusion
- Probability: Medium (2)
- Impact: Medium (2)
- Score: 4 (Medium)
- Description: Without docs, developers miss commands and skip hooks.
- Mitigation: Update README/docs/testing; include commands in story acceptance criteria.
- Testing Focus: Documentation review gate ensures updates exist.

### OPS-205: Pre-commit environment mismatch
- Probability: Low (1)
- Impact: Medium (2)
- Score: 2 (Low)
- Description: `pre-commit` executes with system Python lacking `uvx`, causing hook failure.
- Mitigation: Provide instructions using `repo: local` wrappers or `additional_dependencies`; test on clean machine.
- Testing Focus: Run `pre-commit run --all-files` in CI container to detect mismatches.

## Risk-Based Testing Strategy
- Priority 1: Validate Ruff and Prettier commands across entire repo (CI + local) to ensure coverage (mitigates OPS-201/OPS-202).
- Priority 2: Confirm configuration consolidation by auditing for duplicate `tool.ruff` sections (OPS-204).
- Priority 3: Document workflow and collect feedback from developer dry-run (BUS-201/OPS-203).

## Risk Acceptance Criteria
- Must Fix Before Merge: OPS-201, OPS-202.
- Can Defer with ticket: OPS-205 (documented fallback acceptable).

## Monitoring Requirements (post-merge optional)
- Add CI telemetry for lint stage runtime.
- Track `pre-commit` failure rates in developer retro for two sprints post adoption.

## Story Hook
Risk profile: docs/qa/assessments/2.1-risk-20250916.md
