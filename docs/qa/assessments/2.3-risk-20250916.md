# Risk Profile: Story 2.3 â€” Expand Unit & Integration Coverage

Date: 2025-09-16
Reviewer: Quinn (Test Architect)

## Executive Summary
- Total Risks Identified: 8
- Critical Risks: 1
- High Risks: 3
- Risk Score: 90/100 (calculated)

Coverage expansion touches live auth logic and streaming flows. The biggest risk is flaky or slow integration tests that block CI, followed closely by insufficient coverage enforcement failing to catch regressions.

## Risk Distribution
- Security: 2 (0 critical)
- Performance: 2 (1 critical)
- Data: 0
- Business: 1 (0 critical)
- Operational: 3 (2 high)

## Detailed Risk Register

### PERF-301: Streaming smoke test flakes or hangs (Critical)
- Probability: Medium (2)
- Impact: Critical (4)
- Score: 8 (Critical)
- Description: Long-running or hanging streaming tests can stall CI for minutes and erode trust.
- Mitigation: Implement timeouts, use mocked auth tokens, run under integration marker.
- Testing Focus: Ensure test completes <30s and includes timeout guard.

### OPS-301: Coverage threshold misconfigured or bypassed
- Probability: Medium (2)
- Impact: High (3)
- Score: 6 (High)
- Description: `--cov-fail-under` not set or reports not generated.
- Mitigation: Add explicit option in `pytest.ini`; confirm coverage artifacts exist.
- Testing Focus: Validate coverage enforcement and artifact paths.

### SEC-301: Auth edge-case tests use real credentials improperly
- Probability: Low (1)
- Impact: High (3)
- Score: 3 (Medium)
- Description: Tests might hard-code secrets or use production endpoints.
- Mitigation: Use fixtures and environment variables; sanitize logs.
- Testing Focus: Code review for secret usage.

### OPS-302: Tests rely on network outside repo
- Probability: Low (1)
- Impact: Medium (2)
- Score: 2 (Low)
- Description: Streaming smoke might call internet resources.
- Mitigation: Keep all traffic local; use in-memory server.

### OPS-303: Coverage reports not reproducible locally
- Probability: Medium (2)
- Impact: Medium (2)
- Score: 4 (Medium)
- Description: Paths differ between dev and CI causing inconsistent coverage.
- Mitigation: Standardize output directory; update docs.

### PERF-302: Coverage run time regresses significantly
- Probability: Medium (2)
- Impact: Medium (2)
- Score: 4 (Medium)
- Mitigation: Use `--maxfail` for integration tests; parallelize with `pytest -n auto` later if needed.

### BUS-301: Evidence missing (coverage summary not stored)
- Probability: Medium (2)
- Impact: Medium (2)
- Score: 4 (Medium)
- Mitigation: Add acceptance criterion to upload or link coverage summary.

### SEC-302: Error handling path untested leading to false confidence
- Probability: Medium (2)
- Impact: Medium (2)
- Score: 4 (Medium)
- Mitigation: Add negative tests for `fetch` invalid ID and auth disabled flows.

## Risk-Based Testing Strategy
- Priority 1: Streaming integration test must include deterministic timeout and run under integration marker.
- Priority 2: Enforce coverage threshold and confirm artifact creation.
- Priority 3: Ensure negative-path tests exist for tool functions and auth toggles.

## Risk Acceptance Criteria
- Must Fix Before Merge: PERF-301, OPS-301.
- Can Defer With Ticket: OPS-303, PERF-302.

## Monitoring Requirements (post-merge optional)
- Track historical coverage percentage trend.
- Monitor average runtime of `uv run pytest --cov` in CI.

## Story Hook
Risk profile: docs/qa/assessments/2.3-risk-20250916.md
